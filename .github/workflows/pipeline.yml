name: CI/CD Pipeline - Seguridad y Calidad
on: [push, pull_request]

jobs:
  build-test-security:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout código
        uses: actions/checkout@v3

      - name: Configurar JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: maven

      - name: Ejecutar Pruebas (JUnit)
        run: mvn test

      - name: Análisis de Seguridad Snyk
        uses: snyk/actions/maven@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        continue-on-error: true 

      - name: Análisis de Calidad SonarCloud
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        run: mvn sonar:sonar -Dsonar.projectKey=tu_proyecto_key -Dsonar.organization=tu_org

      - name: Confirmación de Finalización
        [cite_start]run: echo "Pipeline finalizado. Revisar logs para resultados de JUnit, Snyk y Sonar." [cite: 47]
